---
import { Image } from 'astro:assets';

import moon from '../../images/global/moon.png';
import sun from '../../images/global/sun.png';


---
<a id="themeToggle" aria-label="Toggle colour mode">
    <Image class="sun" src={sun} alt="switch to light mode" width="40" height="40" />
    <Image class="moon" src={moon} alt="switch to dark mode" width="40" height="40" />
</a>


<style is:global lang="scss">
    #themeToggle, .moon, .sun{
        position: fixed;
        top: .6rem;
        right: .6rem;
        opacity: 1;
        transition: all .3s ease-in-out;

        &:hover{
          cursor: pointer;
          opacity: .6;
        }
    }

    .moon {
        opacity: 1;
    }
    .sun {
        opacity: 0;
    }

    :global(.dark){
        .moon { opacity: 0 }
        .sun {
            opacity: 1;
            filter: invert(100%);
        }
    }

    @media screen and (max-width: 700px){
        img {
          width: 30px;
          height: 30px;
        }
    }

</style>

<script is:inline>
  const theme = (() => {
    const localStorageTheme = localStorage?.getItem("theme") ?? '';
    if (['dark', 'light'].includes(localStorageTheme)) {
      return localStorageTheme;
    }
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
      return 'light';
  })();

  if (theme === 'light') {
    document.documentElement.classList.remove('dark');
  } else {
    document.documentElement.classList.add('dark');
  }

  window.localStorage.setItem('theme', theme);

  const handleToggleClick = () => {
    const element = document.documentElement;
    element.classList.toggle("dark");

    const isDark = element.classList.contains("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
  }

  document.getElementById("themeToggle")?.addEventListener("click", handleToggleClick);
</script>